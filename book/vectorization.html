<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Introduction to Vectorization - Rust Wrapper for ArrayFire HPC Library</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body class="Coal">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = "Coal";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li><a href="getting_started.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li><a href="vectorization.html" class="active"><strong aria-hidden="true">2.</strong> Introduction to Vectorization</a></li><li><a href="array_and_matrix_manipulation.html"><strong aria-hidden="true">3.</strong> Array and Matrix Manipulation</a></li><li><a href="indexing.html"><strong aria-hidden="true">4.</strong> Indexing</a></li><li><a href="configuring_arrayfire_environment.html"><strong aria-hidden="true">5.</strong> Configuring ArrayFire Runtime Environment</a></li><li><a href="cuda-interop.html"><strong aria-hidden="true">6.</strong> Interoperability with CUDA</a></li><li><a href="opencl-interop.html"><strong aria-hidden="true">7.</strong> Interoperability with OpenCL</a></li><li><a href="multi-threading.html"><strong aria-hidden="true">8.</strong> Multhi-Threading</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Rust Wrapper for ArrayFire HPC Library</h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#vectorization" id="vectorization">Vectorization</a></h1>
<p>Programmers and Data Scientists want to take advantage of fast and parallel computational devices.
Writing vectorized code is necessary to get the best performance out of the current generation
parallel hardware and scientific computing software. However, writing vectorized code may not be
immediately intuitive. ArrayFire provides many ways to vectorize a given code segment. In this
chapter, we present several methods to vectorize code using ArrayFire and discuss the benefits and
drawbacks associated with each method.</p>
<h2><a class="header" href="#genericdefault-vectorization" id="genericdefault-vectorization">Generic/Default vectorization</a></h2>
<p>By its very nature, ArrayFire is a vectorized library. Most functions operate on Arrays as a whole
i.e. on all elements in parallel. For example consider the following code:</p>
<pre><code class="language-rust noplaypen">let mut a = af::range(Dim::new(&amp;[10, 1, 1, 1]));  // [0,  9]
a = a + 1;                                        // [1, 10]
</code></pre>
<p>This code will result in a single kernel that operates on all 10 elements of <code>a</code> in  parallel.</p>
<p>A small subset of such vectorized ArrayFire functions are given below for quick reference:</p>
<table><thead><tr><th>Operator Category</th><th>Functions</th></tr></thead><tbody>
<tr><td>Arithmetic operations</td><td>+, -, *, /, %, &gt;&gt;, &lt;&lt;</td></tr>
<tr><td>Logical operations</td><td>&amp;&amp;, ||, &lt;, &gt;, ==, != etc.</td></tr>
<tr><td>Numeric functions</td><td><a href="http://arrayfire.org/arrayfire-rust/arrayfire/fn.abs.html">abs</a>, <a href="http://arrayfire.org/arrayfire-rust/arrayfire/fn.floor.html">floor</a>, <a href="http://arrayfire.org/arrayfire-rust/arrayfire/fn.round.html">round</a>, <a href="http://arrayfire.org/arrayfire-rust/arrayfire/fn.min.html">min</a>, <a href="http://arrayfire.org/arrayfire-rust/arrayfire/fn.max.html">max</a>, etc.</td></tr>
<tr><td>Complex operations</td><td><a href="http://arrayfire.org/arrayfire-rust/arrayfire/fn.real.html">real</a>, <a href="http://arrayfire.org/arrayfire-rust/arrayfire/fn.imag.html">imag</a>, <a href="http://arrayfire.org/arrayfire-rust/arrayfire/fn.conjg.html">conjg</a>, etc.</td></tr>
<tr><td>Exponential and logarithmic fns</td><td><a href="http://arrayfire.org/arrayfire-rust/arrayfire/fn.exp.html">exp</a>, <a href="http://arrayfire.org/arrayfire-rust/arrayfire/fn.log.html">log</a>, <a href="http://arrayfire.org/arrayfire-rust/arrayfire/fn.expm1.html">expm1</a>, <a href="http://arrayfire.org/arrayfire-rust/arrayfire/fn.log1p.html">log1p</a>, etc.</td></tr>
<tr><td>Trigonometric functions</td><td><a href="http://arrayfire.org/arrayfire-rust/arrayfire/fn.sin.html">sin</a>, <a href="http://arrayfire.org/arrayfire-rust/arrayfire/fn.cos.html">cos</a>, <a href="http://arrayfire.org/arrayfire-rust/arrayfire/fn.tan.html">tan</a>, etc.</td></tr>
<tr><td>Hyperbolic functions</td><td><a href="http://arrayfire.org/arrayfire-rust/arrayfire/fn.sinh.html">sinh</a>, <a href="http://arrayfire.org/arrayfire-rust/arrayfire/fn.cosh.html">cosh</a>, <a href="http://arrayfire.org/arrayfire-rust/arrayfire/fn.tanh.html">tanh</a>, etc.</td></tr>
</tbody></table>
<p>In addition to element-wise operations, many other functions are also vectorized in ArrayFire.</p>
<p>Notice that even functions that perform some form of aggregation (e.g. <a href="http://arrayfire.org/arrayfire-rust/arrayfire/fn.sum.html">sum</a> or <a href="http://arrayfire.org/arrayfire-rust/arrayfire/fn.cos.html">min</a>),
signal processing (like <a href="http://arrayfire.org/arrayfire-rust/arrayfire/fn.convolve1.html">convolve</a>), and image processing functions (i.e. <a href="http://arrayfire.org/arrayfire-rust/arrayfire/fn.rotate.html">rotate</a> etc.)</p>
<ul>
<li>all support vectorization on  different columns or images.</li>
</ul>
<p>For example, if we have <code>NUM</code> images of size <code>WIDTH</code>x<code>HEIGHT</code>, one could convolve each image in a
vector fashion as follows:</p>
<pre><code class="language-rust noplaypen">let g_coef: [f32, 9] = { 1, 2, 1, 2, 4, 2, 1, 2, 1 };

let f = Array::new(g_coef, Dim4::new(&amp;[3, 3, 1, 1]));
let filter = f * 1.0f32/16;

let signal = randu(WIDTH, HEIGHT, NUM);
let conv   = convolve2(signal, filter, ConvMode::DEFAULT, ConvDomain::AUTO);
</code></pre>
<p>Similarly, one can rotate 100 images by 45 degrees in a single call using code like the following:</p>
<pre><code class="language-rust noplaypen">// Construct an array of 100 WIDTH x HEIGHT images of random numbers
let imgs = randu(WIDTH, HEIGHT, 100);

// Rotate all of the images in a single command
let rot_imgs = rotate(imgs, 45.0, False, InterpType::LINEAR);
</code></pre>
<p>Although <em>most</em> functions in ArrayFire do support vectorization, some do not. Most notably, all
linear algebra functions. Even though they are not vectorized linear algebra operations, they still
execute in parallel on your hardware.</p>
<p>Using the built in vectorized operations should be the first and preferred method of vectorizing any
code written with ArrayFire.</p>
<h2><a class="header" href="#gfor" id="gfor">GFOR</a></h2>
<p>This construct is similar to gfor loop from C++ API of ArrayFire. It has not been implemented in
rust wrapper. This section will be updated once the feature has been added to the crate.</p>
<h2><a class="header" href="#batch_func" id="batch_func">batch_func</a></h2>
<p>This another pending feature that is similar to our C++ API of <a href="http://arrayfire.org/docs/namespaceaf.htm#aa0eb9e160f5be4b95234543e5c47934b">batchFunc()</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="getting_started.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="array_and_matrix_manipulation.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="getting_started.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="array_and_matrix_manipulation.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
